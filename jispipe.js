
pipeData = {
    "HIVP": {
        "100A": [114, 7.1],
        "13A": [18, 2.5],
        "150A": [165, 9.6],
        "16A": [22, 3],
        "20A": [26, 3],
        "25A": [32, 3.5],
        "30A": [38, 3.5],
        "40A": [48, 4],
        "50A": [60, 4.5],
        "75A": [89, 5.9]
    },
    "SANITARY": {
        "1.25S": [31.8, 1.2],
        "1.5S": [38.1, 1.2],
        "10A": [17.3, 1.65],
        "15A": [21.7, 2.1],
        "1S": [25.4, 1.2],
        "2.5S": [63.5, 2],
        "200A": [216.3, 4],
        "2S": [50.8, 1.5],
        "3.5S": [89.1, 2],
        "3S": [76.3, 2],
        "4.5S": [114.3, 3],
        "4S": [101.6, 2],
        "5.5S": [139.8, 3],
        "6.5S": [165.2, 3],
        "8A": [13.8, 1.65]
    },
    "SCH10": {
        "350A": [355.6, 6.4],
        "400A": [406.4, 6.4],
        "450A": [457.2, 6.4],
        "500A": [508, 6.4],
        "550A": [558.8, 6.4],
        "600A": [609.6, 6.4],
        "650A": [660.4, 7.9]
    },
    "SCH100": {
        "200A": [216.3, 15.1],
        "250A": [267.4, 18.2],
        "300A": [318.5, 21.4],
        "350A": [355.6, 23.8],
        "400A": [406.4, 26.2],
        "450A": [457.2, 29.4],
        "500A": [508, 32.5],
        "550A": [558.8, 34.9],
        "600A": [609.6, 38.9],
        "650A": [660.4, 41.6]
    },
    "SCH10S": {
        "100A": [114.3, 3],
        "10A": [17.3, 1.65],
        "125A": [139.8, 3.4],
        "150A": [165.2, 3.4],
        "15A": [21.7, 2.1],
        "200A": [216.3, 4],
        "20A": [27.2, 2.1],
        "250A": [267.4, 4],
        "25A": [34, 2.8],
        "300A": [318.5, 4.5],
        "32A": [42.7, 2.8],
        "40A": [48.6, 2.8],
        "50A": [60.5, 2.8],
        "65A": [76.3, 3],
        "6A": [10.5, 1.2],
        "80A": [89.1, 3],
        "8A": [13.8, 1.65],
        "90A": [101.6, 3]
    },
    "SCH120": {
        "100A": [114.3, 11.1],
        "125A": [139.8, 12.7],
        "150A": [165.2, 14.3],
        "200A": [216.3, 18.2],
        "250A": [267.4, 21.4],
        "300A": [318.5, 25.4],
        "350A": [355.6, 27.8],
        "400A": [406.4, 30.9],
        "450A": [457.2, 34.9],
        "500A": [508, 38.1],
        "550A": [558.8, 41.3],
        "600A": [609.6, 46],
        "650A": [660.4, 49.1]
    },
    "SCH140": {
        "200A": [216.3, 20.6],
        "250A": [267.4, 25.4],
        "300A": [318.5, 28.6],
        "350A": [355.6, 31.8],
        "400A": [406.4, 36.5],
        "450A": [457.2, 39.7],
        "500A": [508, 44.4],
        "550A": [558.8, 47.6],
        "600A": [609.6, 52.4],
        "650A": [660.4, 56.6]
    },
    "SCH160": {
        "100A": [114.3, 13.5],
        "125A": [139.8, 15.9],
        "150A": [165.2, 18.2],
        "15A": [21.7, 4.7],
        "200A": [216.3, 23],
        "20A": [27.2, 5.5],
        "250A": [267.4, 28.6],
        "25A": [34, 6.4],
        "300A": [318.5, 33.3],
        "32A": [42.7, 6.4],
        "350A": [355.6, 35.7],
        "400A": [406.4, 40.5],
        "40A": [48.6, 7.1],
        "450A": [457.2, 45.2],
        "500A": [508, 50],
        "50A": [60.5, 8.7],
        "550A": [558.8, 54],
        "600A": [609.6, 59.5],
        "650A": [660.4, 64.2],
        "65A": [76.3, 9.5],
        "80A": [89.1, 11.1],
        "90A": [101.6, 12.7]
    },
    "SCH20": {
        "100A": [114.3, 4.9],
        "125A": [139.8, 5.1],
        "150A": [165.2, 5.5],
        "200A": [216.3, 6.4],
        "250A": [267.4, 6.4],
        "300A": [318.5, 6.4],
        "350A": [355.6, 7.9],
        "400A": [406.4, 7.9],
        "450A": [457.2, 7.9],
        "500A": [508, 9.5],
        "50A": [60.5, 3.2],
        "550A": [558.8, 9.5],
        "600A": [609.6, 9.5],
        "650A": [660.4, 12.7],
        "65A": [76.3, 4.5],
        "80A": [89.1, 4.5],
        "90A": [101.6, 4.5]
    },
    "SCH20S": {
        "100A": [114.3, 4],
        "10A": [17.3, 2],
        "125A": [139.8, 5],
        "150A": [165.2, 5],
        "15A": [21.7, 2.5],
        "200A": [216.3, 6.5],
        "20A": [27.2, 2.5],
        "250A": [267.4, 6.5],
        "25A": [34, 3],
        "300A": [318.5, 6.5],
        "32A": [42.7, 3],
        "40A": [48.6, 3],
        "50A": [60.5, 3.5],
        "65A": [76.3, 3.5],
        "6A": [10.5, 1.5],
        "80A": [89.1, 4],
        "8A": [13.8, 2],
        "90A": [101.6, 4]
    },
    "SCH30": {
        "200A": [216.3, 7],
        "250A": [267.4, 7.8],
        "300A": [318.5, 8.4],
        "350A": [355.6, 9.5],
        "400A": [406.4, 9.5],
        "450A": [457.2, 11.1],
        "500A": [508, 12.7],
        "550A": [558.8, 12.7],
        "600A": [609.6, 14.3]
    },
    "SCH40": {
        "100A": [114.3, 6],
        "10A": [17.3, 2.3],
        "125A": [139.8, 6.6],
        "150A": [165.2, 7.1],
        "15A": [21.7, 2.8],
        "200A": [216.3, 8.2],
        "20A": [27.2, 2.9],
        "250A": [267.4, 9.3],
        "25A": [34, 3.4],
        "300A": [318.5, 10.3],
        "32A": [42.7, 3.6],
        "350A": [355.6, 11.1],
        "400A": [406.4, 12.7],
        "40A": [48.6, 3.7],
        "450A": [457.2, 14.3],
        "500A": [508, 15.1],
        "50A": [60.5, 3.9],
        "550A": [558.8, 15.9],
        "600A": [609.6, 17.5],
        "650A": [660.4, 18.9],
        "65A": [76.3, 5.2],
        "6A": [10.5, 1.7],
        "80A": [89.1, 5.5],
        "8A": [13.8, 2.2],
        "90A": [101.6, 5.7]
    },
    "SCH5S": {
        "100A": [114.3, 2.1],
        "10A": [17.3, 1.2],
        "125A": [139.8, 2.8],
        "150A": [165.2, 2.8],
        "15A": [21.7, 1.65],
        "200A": [216.3, 2.8],
        "20A": [27.2, 1.65],
        "250A": [267.4, 3.4],
        "25A": [34, 1.65],
        "300A": [318.5, 4],
        "32A": [42.7, 1.65],
        "40A": [48.6, 1.65],
        "50A": [60.5, 1.65],
        "65A": [76.3, 2.1],
        "6A": [10.5, 1],
        "80A": [89.1, 2.1],
        "8A": [13.8, 1.2],
        "90A": [101.6, 2.1]
    },
    "SCH60": {
        "100A": [114.3, 7.1],
        "10A": [17.3, 2.8],
        "125A": [139.8, 8.1],
        "150A": [165.2, 9.3],
        "15A": [21.7, 3.2],
        "200A": [216.3, 10.3],
        "20A": [27.2, 3.4],
        "250A": [267.4, 12.7],
        "25A": [34, 3.9],
        "300A": [318.5, 14.3],
        "32A": [42.7, 4.5],
        "350A": [355.6, 15.1],
        "400A": [406.4, 16.7],
        "40A": [48.6, 4.5],
        "450A": [457.2, 19],
        "500A": [508, 20.6],
        "50A": [60.5, 4.9],
        "550A": [558.8, 22.2],
        "600A": [609.6, 24.6],
        "650A": [660.4, 26.4],
        "65A": [76.3, 6],
        "6A": [10.5, 2.2],
        "80A": [89.1, 6.6],
        "8A": [13.8, 2.4],
        "90A": [101.6, 7]
    },
    "SCH80": {
        "100A": [114.3, 8.6],
        "10A": [17.3, 3.2],
        "125A": [139.8, 9.5],
        "150A": [165.2, 11],
        "15A": [21.7, 3.7],
        "200A": [216.3, 12.7],
        "20A": [27.2, 3.9],
        "250A": [267.4, 15.1],
        "25A": [34, 4.5],
        "300A": [318.5, 17.4],
        "32A": [42.7, 4.9],
        "350A": [355.6, 19],
        "400A": [406.4, 21.4],
        "40A": [48.6, 5.1],
        "450A": [457.2, 23.8],
        "500A": [508, 26.2],
        "50A": [60.5, 5.5],
        "550A": [558.8, 28.6],
        "600A": [609.6, 31],
        "650A": [660.4, 34],
        "65A": [76.3, 7],
        "6A": [10.5, 2.4],
        "80A": [89.1, 7.6],
        "8A": [13.8, 3],
        "90A": [101.6, 8.1]
    },
    "SGP": {
        "100A": [114.3, 4.5],
        "10A": [17.3, 2.3],
        "125A": [139.8, 4.5],
        "150A": [165.2, 5],
        "15A": [21.7, 2.8],
        "175A": [190.7, 5.3],
        "200A": [216.3, 5.8],
        "20A": [27.2, 2.8],
        "225A": [241.8, 6.2],
        "250A": [267.4, 6.6],
        "25A": [34, 3.2],
        "300A": [318.5, 6.9],
        "32A": [42.7, 3.5],
        "350A": [355.6, 7.9],
        "400A": [406.4, 7.9],
        "40A": [48.6, 3.5],
        "450A": [457.2, 7.9],
        "500A": [508, 7.9],
        "50A": [60.5, 3.8],
        "65A": [76.3, 4.2],
        "6A": [10.5, 2],
        "80A": [89.1, 4.2],
        "8A": [13.8, 2.3],
        "90A": [101.6, 4.2]
    },
    "VLP": {
        "100A": [114.3, 5.8],
        "125A": [139.8, 5.9],
        "150A": [165.2, 6.8],
        "200A": [216.3, 7.5],
        "40A": [48.6, 4.7],
        "50A": [60.5, 4.7],
        "65A": [76.3, 5],
        "80A": [89.1, 5.5]
    },
    "VP": {
        "100A": [114, 6.6],
        "125A": [140, 7],
        "13A": [18, 2.2],
        "150A": [165, 8.9],
        "16A": [22, 2.7],
        "200A": [216, 10.3],
        "20A": [26, 2.7],
        "250A": [267, 12.7],
        "25A": [32, 3.1],
        "300A": [318, 15.1],
        "30A": [38, 3.1],
        "40A": [48, 3.6],
        "50A": [60, 4.1],
        "65A": [76, 4.1],
        "75A": [89, 5.5]
    },
    "VU": {
        "100A": [114, 3.1],
        "125A": [140, 4.1],
        "150A": [165, 5.1],
        "200A": [216, 6.5],
        "250A": [267, 7.8],
        "300A": [318, 9.2],
        "40A": [48, 1.8],
        "50A": [60, 1.8],
        "65A": [76, 2.2],
        "75A": [89, 2.7]
    }
}

lastInput = null;


function pipeInternalDia(nt, nd){
	var d = pipeData[nt][nd];
	var od = d[0];
	var t = d[1];
  var id = od - t*2
	return Math.round(id*10) / 10;
}


function setDiameter(){
  var nd = document.getElementById("nominalDiameter").value;
  var nt = document.getElementById("nominalThickness").value;
  var d = pipeInternalDia(nt, nd)

  setNumber("diameter", d);
}


function setFlowRate(elem, fr=null){
  lastInput = elem;

  if(!fr){
    var id = getNumber("diameter");
    var v = getNumber("velocity");
    fr = Math.pow(id/1000, 2)* Math.PI / 4 * v; // m3/s
  }

  var frLpm = fr * 1000 * 60;
  var frCmm = fr * 60;
  var frCmh = fr * 60 * 60;

  setNumber("flowRateLPM", frLpm);
  setNumber("flowRateCMM", frCmm);
  setNumber("flowRateCMH", frCmh);
}


function setVelocity(elem, unit){
  lastInput = elem;

  var frU = elem.value;
  var coef = {
    "LPM": 1000 * 60,
    "CMM": 60,
    "CMH": 60 * 60
  }[unit]

  var fr = frU / coef;
  setFlowRate(elem, fr);

  var id = getNumber("diameter");
  var v = fr / (Math.pow(id/1000, 2) * Math.PI / 4);

  setNumber("velocity", v);
}


function repeatCalc(){
  lastInput.onchange();
}


function getNumber(id){
  return Number(document.getElementById(id).value)
}


function setNumber(id, value){
  document.getElementById(id).value = sround(value, 4);
}


function sround(num, digit){
  var selfdigit = Math.floor(Math.log10(Math.abs(num))) + 1;
  var x = Math.pow(10, digit - selfdigit);

  return Math.round(num * x) / x;
}
